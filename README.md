## Кратное описание проекта

Данные проект является бэком для фронта https://exkursiacaramel.ru/

Этот проектЖ
- передает фронту все евенты, которые есть по конкретному городу в битриксе.
- актуализирует места в битриксе, при бронировании
- выставляет счет клиенту через робокассу
- отображает карточку заказа
- добавляет контакт и сделку в битрикс при бронировании
- синхронизирует все с бд ( архитектура ниже )


Бэк расположен в яндекл клауд. Там крутиться вм.

## Сессии

Механизм запуска сессии реализовано через терминальный мультиплексор tmux. 
На серваке можно посмотореть команды, самые главные это tmux kill-session -t "$SESSION_NAME", tmux a -t spb, tmux new-session

## CI CD

start-bitrix.sh - на серваке в нем содержится команды для перезапуска сессии для каждого города. Как последний этап пайплана в /.github/workflows/deploy-dev.yml это файл запускается.
Его бы стоит отключить, если идут активные продажи на сайте.

## БД

Бд на серваке потсгрес. Конкретная шима на данный момент называется KARAMEL
В проекте есть миграция через flyway. В пропертях лежит

### CURRENT_CITY - конкретный город. Список можно взять в application.yaml, например chel, msk, ekb и так даллее. В пропертях есть по каждому городу инфа.
### APP_PORT - значение порта. В классе NameOfCity есть маппинг порта и конкретного города. Эти порты заложены в nginx. Например, при создании сессии для Челябинска, спринг должен быть запущен на порту 8090, так как запросы на хост chelyabinsk.exkursiacaramel будут перенаправляться на порт 8090. То есть каждая сессия, для каждого города.

# Запуск локально
Необходимо указать значения CURRENT_CITY APP_PORT и поднять базу. Докер компос добавлен в проект для удобства

# Диаграмма бд

![contact](https://github.com/user-attachments/assets/678ffa7c-8ab0-40a7-b500-7afdda257505)
