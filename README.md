# Краткое описание проекта

Данный проект является бэком для https://exkursiacaramel.ru/

Этот проект:
- передает фронту все евенты, которые есть по конкретному городу в битриксе.
- актуализирует места в битриксе, при бронировании
- выставляет счет клиенту через робокассу на сайте
- отображает карточку заказа
- добавляет контакт и сделку в битрикс при бронировании
- синхронизирует все с бд ( архитектура ниже )
- отправляет билеты на почту при успешной оплате
- переносит карточку сделки в битриске в столбец оплачено

## ВМ

Бэк расположен в яндекл клауд. Там крутиться вм. Может ее нужно включить, все пароли связки у руководителя проекта.
ssh admin@158.160.121.159 -i /home/тут ключ. Стоит обратиться ко мне за ключом (:

## NGINX

Все маршруты проложены в файле ~/ect/nginx/sites-available/default

## Сессии

Механизм запуска сессии реализовано через терминальный мультиплексор tmux. 
На серваке можно посмотреть команды, самые главные это tmux kill-session -t "$SESSION_NAME", tmux a -t karamel, tmux new-session

## Фронт

Фронт лежит вроде там, я туда не лез. /home/admin/ticket-system/dist/ticket-system

## CI CD

1. Собираем джарник с названием service.jar
2. Заливаем его в папку ~/actual-version/files/
3. Запускаем скриптом  ~/actual-version/start-app.sh .Там перезапуск сессии и запуск джарника

## БД

Бд на серваке потсгрес. Конкретная шима на данный момент называется KARAMEL
В проекте есть миграция через flyway. В пропертях лежит

## Запуск локально
Докер компос для удобства. Стартуем базу и нажимаем плей

## Диаграмма бд

Евент - слоты в битриск
Контакт - конаткт в битриск
Деал - сделки в битрикс
Инвойс - информация про счет и тд.

![Screenshot from 2024-10-17 14-29-02](https://github.com/user-attachments/assets/32a0593c-3c10-4b9f-91fa-ff2cac753a0c)

